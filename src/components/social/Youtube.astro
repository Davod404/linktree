---
import CustomArrow from "../CustomArrow.astro";
import YoutubeIcon from "../icons/YoutubeIcon.astro";
---

<article
  class="circle group block text-white blur-effect border-2 border-[#3D2D42] col-span-5 relative min-h-[150px] rounded-[24px] overflow-hidden"
>
  <a id="videoLink" href=`https://www.youtube.com/` target="_blank">
    <div class="flex items-center w-full h-full p-6">
      <div class="w-full h-full flex flex-col justify-center s-4">
        <p class="text-white text-2xl font-bold">Último vídeo</p>
        <div class="flex items-center gap-x-4">
          <div
            id="videoTitle"
            class="text-white underline font-semibold text-xl"
          >
            Cargando...
          </div>
          <CustomArrow />
        </div>
      </div>

      <YoutubeIcon width="64px" height="48px" />

      <div
        id="videoImage"
        style=`background-repeat: no-repeat; opacity: 0.1; background-size: cover; background-position: center;`
        class="absolute top-0 z-10 w-full h-full"
      >
      </div>
    </div>
  </a>
</article>

<script type="module">
  const BASE_URL = "https://decapi.me/youtube/latest_video?";
  const USER_ID = "UCkDwFvETfXmnIwpX7lV3F1g";
  const FORMAT = '{"id":"{id}","title":"{title}"}';
  const QUERY_PARAMS = "no_livestream=0&no_shorts=0";
  const FINAL_URL = `${BASE_URL}id=${USER_ID}&format=${FORMAT}&${QUERY_PARAMS}`;

  const response = await fetch(FINAL_URL);
  const { title, id } = await response.json();

  const videoLink = document.getElementById("videoLink");
  const videoTitle = document.getElementById("videoTitle");
  const videoImage = document.getElementById("videoImage");

  videoLink.href = `https://www.youtube.com/watch?v=${id}`;
  videoTitle.textContent = title;
  videoImage.style.backgroundImage = `url(https://img.youtube.com/vi/${id}/hqdefault.jpg)`;
</script>
